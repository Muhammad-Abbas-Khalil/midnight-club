<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE MIDNIGHT CLUB</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom Config for Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        black: '#050505',
                        neonGreen: '#0f0',
                        hotPink: '#f0f',
                        offBlack: '#0a0a0a',
                    },
                    fontFamily: {
                        mono: ['"Fira Code"', '"Courier New"', 'monospace'],
                    },
                    animation: {
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'glitch': 'glitch 1s linear infinite',
                    },
                    keyframes: {
                        glitch: {
                            '2%, 64%': { transform: 'translate(2px,0) skew(0deg)' },
                            '4%, 60%': { transform: 'translate(-2px,0) skew(0deg)' },
                            '62%': { transform: 'translate(0,0) skew(5deg)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* CORE AESTHETICS */
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap');

        body {
            background-color: #050505;
            color: #0f0;
            font-family: 'Fira Code', 'Courier New', monospace;
            overflow: hidden;
        }

        /* CRT EFFECT OVERLAY */
        .crt-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%,
                    rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg,
                    rgba(255, 0, 0, 0.06),
                    rgba(0, 255, 0, 0.02),
                    rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 999;
            animation: crt-flicker 0.15s infinite;
        }

        @keyframes crt-flicker {
            0% {
                opacity: 0.95;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.98;
            }
        }

        /* CUSTOM UTILITIES */
        .text-neon {
            text-shadow: 0 0 5px #0f0, 0 0 10px #0f0, 0 0 20px #0f0;
        }

        .text-pink {
            color: #f0f;
            text-shadow: 0 0 5px #f0f, 0 0 10px #f0f;
        }

        .border-neon {
            box-shadow: 0 0 5px #0f0, inset 0 0 5px #0f0;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #050505;
        }

        ::-webkit-scrollbar-thumb {
            background: #0f0;
            border: 1px solid #050505;
        }

        /* UTILITY CLASSES */
        .hidden {
            display: none !important;
        }

        /* TERMINAL CURSOR */
        .cursor-blink::after {
            content: '_';
            animation: blink 1s step-end infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }
    </style>
</head>

<body class="h-screen w-screen flex flex-col items-center justify-center p-4">

    <!-- CRT OVERLAY -->
    <div class="crt-overlay"></div>

    <!-- MAIN TITLE -->
    <header class="absolute top-4 left-4 z-50">
        <h1 class="text-2xl md:text-3xl font-bold tracking-tighter animate-glitch text-neon">
            THE MIDNIGHT CLUB
        </h1>
        <div id="connection-status" class="text-xs text-pink mt-1 opacity-70">
            [SECURE_CONNECTION_ESTABLISHED]
        </div>
    </header>

    <!-- CONTENT: LOCKED STATE -->
    <div id="locked-state" class="hidden flex-col items-center justify-center text-center z-10 w-full max-w-2xl">
        <div class="border border-neon p-8 bg-black bg-opacity-80 w-full">
            <h2 class="text-xl mb-6 tracking-widest text-pink font-bold">ACCESS DENIED</h2>
            <div class="text-6xl md:text-8xl font-bold mb-4 font-mono" id="countdown">00:00:00</div>
            <p class="text-sm md:text-base animate-pulse text-neon mt-4 uppercase tracking-widest">
                We open when the city sleeps.
            </p>
            <div class="mt-8 text-xs text-gray-500 border-t border-gray-800 pt-4">
                HOURS: 23:00 - 03:00 LOCAL TIME
            </div>
        </div>
    </div>

    <!-- CONTENT: OPEN STATE (LOGIN) -->
    <div id="login-state" class="hidden flex-col items-center justify-center z-10 w-full max-w-md">
        <div class="border border-neon p-6 bg-black bg-opacity-90 w-full">
            <h2 class="text-lg mb-4 text-neon">> AUTHENTICATE_USER</h2>
            <div class="mb-6">
                <input type="text" id="alias-input" placeholder="ENTER ALIAS..."
                    class="w-full bg-black border-b-2 border-neon text-neon focus:outline-none focus:border-pink py-2 font-mono uppercase"
                    maxlength="15" autocomplete="off">
            </div>
            <button id="enter-btn"
                class="w-full border border-neon text-neon hover:bg-neonGreen hover:text-black py-3 font-bold transition-all duration-200 uppercase tracking-widest">
                ENTER THE FLOOR
            </button>
        </div>
    </div>

    <!-- CONTENT: OPEN STATE (CHAT FLOOR) -->
    <div id="chat-state" class="hidden flex-col w-full h-full max-w-4xl pt-20 pb-4 z-10 px-2 md:px-0">

        <!-- HEADER INFO -->
        <div class="flex justify-between items-end mb-2 border-b border-neon pb-2 text-xs md:text-sm">
            <span>USER: <span id="user-display" class="text-pink">GUEST</span></span>
            <span class="text-pink">SELF_DESTRUCT: <span id="self-destruct-timer"
                    class="font-bold">--:--:--</span></span>
        </div>

        <!-- CHAT FEED -->
        <div id="chat-feed"
            class="flex-1 overflow-y-auto mb-4 border-l-2 border-gray-800 pl-4 space-y-2 pr-2 font-mono text-sm md:text-base">
            <!-- Messages will be injected here -->
            <div class="opacity-50 italic text-xs">> SYSTEM: Connected to secure frequency...</div>
        </div>

        <!-- INPUT AREA -->
        <div class="flex space-x-2">
            <input type="text" id="message-input"
                class="flex-1 bg-offBlack border border-gray-700 p-3 text-neon focus:outline-none focus:border-neon font-mono"
                placeholder="TRANSMIT MESSAGE..." autocomplete="off">
            <button id="send-btn"
                class="bg-neonGreen text-black px-6 font-bold hover:bg-white transition-colors uppercase">
                SEND
            </button>
        </div>
    </div>

    <!-- CONTENT: SYSTEM WIPE ANIMATION -->
    <div id="wipe-state" class="hidden fixed inset-0 bg-black z-[100] flex items-center justify-center flex-col">
        <h1 class="text-4xl md:text-6xl text-pink font-bold animate-pulse text-center">SYSTEM PURGE_INITIATED</h1>
        <div class="w-64 h-2 bg-gray-900 mt-8 rounded overflow-hidden">
            <div class="h-full bg-pink w-0 animate-[width_3s_ease-in-out_forwards]" style="transition: width 3s;"></div>
        </div>
        <p class="mt-4 text-neon font-mono text-xs">ERASING TRACES...</p>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script type="module">
        // ---------------------------------------------------------
        // 1. CONFIGURATION & STATE
        // ---------------------------------------------------------

        // --- FIREBASE CONFIG (PLACEHOLDER) ---
        // To enable real backend:
        // 1. Create a Firebase project
        // 2. Enable Realtime Database (in Locked Mode or Test Mode)
        // 3. Paste config below and set USE_FIREBASE = true

        const USE_FIREBASE = true; // Set to true after adding keys

        const firebaseConfig = {
            apiKey: "[GCP_API_KEY]",
            authDomain: "midnight-club-6b9f4.firebaseapp.com",
            databaseURL: "https://midnight-club-6b9f4-default-rtdb.firebaseio.com",
            projectId: "midnight-club-6b9f4",
            storageBucket: "midnight-club-6b9f4.firebasestorage.app",
            messagingSenderId: "151877926407",
            appId: "1:151877926407:web:a12fc3abbefa46551f74a2",
            measurementId: "G-K3V8SC2JB6"
        };

        // --- GLOBAL VARIABLES ---
        let currentUser = null;
        let db = null;
        let messagesRef = null;
        let push = null;
        let serverTimestamp = null;

        // Elements
        const elLocked = document.getElementById('locked-state');
        const elLogin = document.getElementById('login-state');
        const elChat = document.getElementById('chat-state');
        const elWipe = document.getElementById('wipe-state');
        const elCountdown = document.getElementById('countdown');
        const elSelfDestruct = document.getElementById('self-destruct-timer');
        const elChatFeed = document.getElementById('chat-feed');
        const elMessageInput = document.getElementById('message-input');

        // ---------------------------------------------------------
        // 2. THE BOUNCER (TIME LOGIC)
        // ---------------------------------------------------------

        function checkTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();

            // CLUB HOURS: 23:00 (11PM) to 03:00 (3AM)
            // Logic: 
            // If hours >= 23, it is OPEN (hours 23).
            // If hours < 3, it is OPEN (hours 0, 1, 2).
            // BUT: Special case handled by 'isClubOpen'

            const isClubOpen = (hours >= 23) || (hours < 3);

            // AUTO WIPE CHECK
            // If it is exactly 03:01:00 to 03:01:05, trigger wipe
            if (hours === 3 && minutes === 1 && seconds < 5) {
                triggerWipe();
                return;
            }

            if (isClubOpen) {
                // Determine active UI based on login state
                if (elWipe.classList.contains('hidden')) {
                    if (!currentUser) {
                        showScreen('login');
                    } else {
                        // Already logged in, ensure chat is visible if not wiped
                        if (elChat.classList.contains('hidden')) showScreen('chat');
                    }
                }

                // UPDATE SELF-DESTRUCT TIMER (Counts down to 03:00 AM)
                // Determine target end time
                let target = new Date();
                if (hours >= 23) {
                    // Target is tomorrow 03:00
                    target.setDate(target.getDate() + 1);
                    target.setHours(3, 0, 0, 0);
                } else {
                    // Target is today 03:00
                    target.setHours(3, 0, 0, 0);
                }
                updateTimerDisplay(elSelfDestruct, target, false);

            } else {
                // CLOSED
                showScreen('locked');

                // UPDATE COUNTDOWN TIMER (Counts down to 23:00 TODAY)
                // If it's past 3am but before 11pm, target is today 23:00
                let target = new Date();
                target.setHours(23, 0, 0, 0);
                updateTimerDisplay(elCountdown, target, true);
            }
        }

        function updateTimerDisplay(element, targetDate, showHours) {
            const now = new Date();
            const diff = targetDate - now;

            if (diff <= 0) {
                element.innerText = "00:00:00";
                return;
            }

            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);

            const hh = h.toString().padStart(2, '0');
            const mm = m.toString().padStart(2, '0');
            const ss = s.toString().padStart(2, '0');

            element.innerText = `${hh}:${mm}:${ss}`;
        }

        function showScreen(screenName) {
            // Helper to toggle visibility. 
            // Only toggle if not already active to prevent flickering inputs or resets
            const screens = {
                locked: elLocked,
                login: elLogin,
                chat: elChat,
                wipe: elWipe
            };

            for (const key in screens) {
                if (key === screenName) {
                    screens[key].classList.remove('hidden');
                    screens[key].classList.add('flex');
                } else {
                    screens[key].classList.add('hidden');
                    screens[key].classList.remove('flex');
                }
            }
        }

        function triggerWipe() {
            showScreen('wipe');
            currentUser = null;
            // Animation for bar is CSS. After 4 seconds, reload page.
            setTimeout(() => {
                window.location.reload();
            }, 4000);
        }

        // ---------------------------------------------------------
        // 3. CHAT LOGIC (FIREBASE + LOCAL FALLBACK)
        // ---------------------------------------------------------

        async function initApp() {
            // Start the clock
            setInterval(checkTime, 1000);
            checkTime(); // Initial check

            // Listeners
            document.getElementById('enter-btn').addEventListener('click', login);
            document.getElementById('alias-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') login();
            });

            document.getElementById('send-btn').addEventListener('click', sendMessage);
            elMessageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });

            // Firebase Init
            if (USE_FIREBASE) {
                try {
                    // Dynamic Import for Firebase SDKs from CDN
                    // Dynamic Import for Firebase SDKs from CDN
                    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                    const firebaseDatabase = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');

                    const { getDatabase, ref, onChildAdded } = firebaseDatabase;
                    push = firebaseDatabase.push;
                    serverTimestamp = firebaseDatabase.serverTimestamp;

                    const app = initializeApp(firebaseConfig);
                    db = getDatabase(app);
                    messagesRef = ref(db, 'messages');

                    // Listener for new messages
                    onChildAdded(messagesRef, (snapshot) => {
                        const data = snapshot.val();
                        appendMessage(data.user, data.text, data.timestamp);
                    });

                    console.log("[SYSTEM] Firebase Connected.");

                } catch (e) {
                    console.error("Firebase Init Error:", e);
                    appendMessage("SYSTEM", "CONNECTION ERROR. SWITCHING TO LOCAL MODE.", Date.now());
                }
            }
        }

        function login() {
            const input = document.getElementById('alias-input');
            const alias = input.value.trim().toUpperCase();

            if (alias.length > 0) {
                currentUser = alias;
                document.getElementById('user-display').innerText = currentUser;
                showScreen('chat'); // Switch to Chat

                // Welcome message
                setTimeout(() => {
                    appendMessage("SYSTEM", `WELCOME, ${currentUser}. ENCRYPTION ACTIVE.`, Date.now());
                }, 500);
            }
        }

        function sendMessage() {
            const text = elMessageInput.value.trim();
            if (!text || !currentUser) return;

            if (USE_FIREBASE && db && push) {
                // Send to Firebase
                push(messagesRef, {
                    user: currentUser,
                    text: text,
                    timestamp: serverTimestamp()
                });

            } else {
                // LOCAL MODE
                appendMessage(currentUser, text, Date.now());

                // Simulation: Random bot reply
                if (Math.random() > 0.7) {
                    setTimeout(() => {
                        const replies = [
                            "I heard that too.",
                            "The signal is weak tonight.",
                            "Did you see the new data dump?",
                            "Keep it down, mods are watching.",
                            "lol"
                        ];
                        const randomReply = replies[Math.floor(Math.random() * replies.length)];
                        appendMessage("GHOST_User", randomReply, Date.now());
                    }, 2000);
                }
            }

            elMessageInput.value = '';
        }

        function appendMessage(user, text, timestamp) {
            const timeStr = new Date(timestamp).toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit' });

            const msgDiv = document.createElement('div');
            msgDiv.className = "mb-2 hover:bg-gray-900 p-1 rounded transition-colors";

            const isMe = (user === currentUser);
            const userColor = isMe ? 'text-neon' : 'text-pink';
            const userLabel = isMe ? `<span class="${userColor} font-bold">[${user}]</span>` : `<span class="${userColor}">[${user}]</span>`;

            msgDiv.innerHTML = `
                <span class="text-gray-500 text-xs mr-2">[${timeStr}]</span>
                ${userLabel}
                <span class="${isMe ? 'text-white' : 'text-gray-300'} break-words">${escapeHtml(text)}</span>
            `;

            elChatFeed.appendChild(msgDiv);
            elChatFeed.scrollTop = elChatFeed.scrollHeight;
        }

        function escapeHtml(text) {
            if (!text) return text;
            return text.replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Run
        initApp();

    </script>
</body>

</html>